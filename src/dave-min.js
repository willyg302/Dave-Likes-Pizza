Game={start:function(){window.sag=new Sagittarius("sagittarius-test","password"),Crafty.init(640,480),Crafty.background("url('assets/bg.png') no-repeat"),Crafty.scene("Loading")}},Crafty.c("Actor",{init:function(){this.requires("2D, DOM"),this.attr({w:64,h:64})},size:function(a,b){return void 0===a&&void 0===b?{w:64,h:64}:(this.attr({w:a,h:b}),this)},at:function(a,b){return void 0===a&&void 0===b?{x:0,y:0}:(this.attr({x:a,y:b}),this)}}),Crafty.c("Solid",{init:function(){this.requires("Actor")}}),Crafty.c("Ground",{init:function(){this.requires("Actor, Gravity").size(640,80).at(0,400)}}),Crafty.c("Player",{init:function(){this.requires("Actor, Twoway, SpriteAnimation, daveNorm, Gravity, Collision, Delay").twoway(4,8).onHit("Pizza",this.handlePizza).onHit("Powerup",this.handlePowerup).onHit("Solid",this.stopMovement).animate("Still",0,0,0).animate("MovingRight",0,1,4).animate("MovingLeft",0,2,4).animate("Chomping",0,3,4).animate("PoweredUp",0,4,4).animate("Burping",1,0,0),this.bind("PizzaEaten",function(){Crafty.audio.play("chomp"),this.animate("Chomping",30,0).bind("AnimationEnd",function(){this.trigger("NewDirection",this._movement)}),Math.random()<.2&&this.delay(function(){Crafty.audio.play("burp"),this.animate("Burping",30,0).bind("AnimationEnd",function(){this.trigger("NewDirection",this._movement)})},500,0)}),this.bind("PowerupEaten",function(){Crafty.audio.play("powerup"),this.animate("PoweredUp",30,0).bind("AnimationEnd",function(){this.trigger("NewDirection",this._movement)})}),this.bind("PowerupDone",function(){Crafty.audio.play("powerdown")});var a=5;this.bind("NewDirection",function(b){b.x>0?this.animate("MovingRight",a,-1):b.x<0?this.animate("MovingLeft",a,-1):this.animate("Still",a,-1)}),this.bind("EnterFrame",function(){this.disableControls||0!==this._movement.x&&window.hasBacon&&(this.x+=this._movement.x)})},handlePizza:function(a){pizzaToEat=a[0].obj,pizzaToEat.destroy(),Crafty.trigger("PizzaEaten",pizzaToEat.type)},handlePowerup:function(a){powerupToEat=a[0].obj,powerupToEat.destroy(),Crafty.trigger("PowerupEaten",powerupToEat.type);var b="";switch(powerupToEat.type){case"bacon":window.hasBacon=!0,b="Blitz Bacon!";break;case"muffin":window.hasMuffin=!0,b="Multiplier Muffin!";break;case"fries":window.hasFries=!0,b="Freeze Fries!";break;case"melon":window.hasMelon=!0,b="Magnet Melon!";break;case"donut":window.hasDonut=!0,b="Double-Point Donut!"}Crafty.e("Toast").size(200,50).at(220,200).text(b),this.delay(function(){switch(Crafty.trigger("PowerupDone",powerupToEat.type),powerupToEat.type){case"bacon":window.hasBacon=!1;break;case"muffin":window.hasMuffin=!1;break;case"fries":window.hasFries=!1;break;case"melon":window.hasMelon=!1;break;case"donut":window.hasDonut=!1}window.hasPowerup=!1},1e4,0)},stopMovement:function(){this._movement?(this.x-=this._movement.x,0!=this.hit("Solid")&&(this.x+=this._movement.x,this.y-=this._movement.y,0!=this.hit("Solid")&&(this.x-=this._movement.x,this.y-=this._movement.y))):this._speed=0}}),Crafty.c("FallingObject",{init:function(){this.requires("Actor, Gravity, Collision").gravity().gravityConst(.3).onHit("Ground",this.hitGround)},hitGround:function(){Crafty.e("2D, DOM, SpriteAnimation, "+this.type).attr({x:this._x,y:360+Crafty.math.randomInt(-3,3)}).animate("Splat",1,this.__coord[1]/64,2).animate("Splat",1,0),Crafty.audio.play("splat"),this.isPowerup&&(window.hasPowerup=!1),this.destroy()},settype:function(a){this.isPowerup=-1!=["bacon","muffin","fries","melon","donut"].indexOf(a),this.type=a,this.addComponent(a)}}),Crafty.c("Pizza",{init:function(){this.requires("FallingObject")}}),Crafty.c("Powerup",{init:function(){this.requires("FallingObject")}}),Crafty.c("PizzaManager",{init:function(){this.requires("Delay")},start:function(){this.next()},next:function(){this.delay(function(){var a=Crafty.math.randomInt(0,99),b="cheese",c=!1;5>a&&!window.hasPowerup?(c=!0,b=["bacon","muffin","fries","melon","donut"][Crafty.math.randomInt(0,4)]):10>a||window.hasMuffin?b="supreme":25>a?b="veggie":50>a&&(b="pepperoni");var d=window.hasMelon?250:0,e=Crafty.math.randomInt(0+d,576-d);c?(window.hasPowerup=!0,Crafty.e("Powerup").at(e,-64).settype(b)):Crafty.e("Pizza").at(e,-64).settype(b),this.next()},500,0)}}),Crafty.c("Button",{init:function(){this.requires("Actor, SpriteAnimation, Mouse")},setup:function(a,b,c){return this.animate("norm",a+c,b,a).animate("over",a,b,a+c).animate("clik",a+c,b,a+2*c).animate("unclik",a+2*c,b,a+c).bind("MouseOver",function(){this.animate("over",1,0)}).bind("MouseOut",function(){this.animate("norm",1,0)}).bind("MouseDown",function(){this.animate("clik",1,0)}).bind("MouseUp",function(){this.animate("unclik",1,0)}),this}}),Crafty.c("Txt",{init:function(){this.requires("Actor, Text").textFont({size:"24px",family:"Acme"}).unselectable(),this.z=100}}),Crafty.c("TxtLink",{init:function(){this.requires("Txt").css({color:"white"})},setup:function(a,b){return this.text('<span id="'+a+'"><a href="#" onclick="return false;">'+b+"</a></span>"),this}}),Crafty.c("Toast",{init:function(){this.requires("Txt, Tween").css({color:"white"}),this.tween({alpha:0,y:this.y-50},60)}}),Crafty.c("Countdown",{init:function(){this.requires("Txt, Delay"),this.timeLeft=1200},start:function(){this.delay(function(){window.hasFries||this.timeLeft--;var a=Math.floor(this.timeLeft/600),b=Math.floor(this.timeLeft/10%60),c=Math.floor(this.timeLeft%10),d=10>b?"0":"";this.text(a+":"+d+b+"."+c+"0"),0==this.timeLeft&&Crafty.trigger("TimesUp",this)},100,-1)}}),Crafty.c("DaveLogo",{init:function(){this.requires("Actor, Image, Tween").image("assets/dave-logo.png").at(100,60)},bob:function(){this.tween({y:80==this.y?60:80},60).bind("TweenEnd",function(){this.unbind("TweenEnd"),this.bob()})}}),Crafty.scene("Menu",function(){Crafty.audio.stop(),Crafty.audio.play("menumusic",-1),Crafty.e("DaveLogo").bob(),Crafty.e("TxtLink").textFont({size:"36px"}).size(210,50).at(5,320).setup("playtxt","Play"),Crafty.e("TxtLink").textFont({size:"36px"}).size(210,50).at(215,320).setup("leadertxt","Leaderboards"),Crafty.e("TxtLink").textFont({size:"36px"}).size(210,50).at(425,320).setup("creditstxt","Credits"),Crafty.DrawManager.draw(),document.getElementById("playtxt").onclick=function(){Crafty.scene("Game")},document.getElementById("leadertxt").onclick=function(){Crafty.scene("Leaderboards")},document.getElementById("creditstxt").onclick=function(){Crafty.scene("Credits")}}),Crafty.scene("Leaderboards",function(){Crafty.e("Txt").textFont({size:"36px"}).size(600,40).at(20,20).css({color:"white","text-align":"left"}).text("Leaderboards");var a=Crafty.e("Txt").textFont({size:"18px"}).size(560,260).at(40,80).css({color:"white","text-align":"left"}).text("Loading...");window.sag.GetLeaderboard({name:"davelb1",callback:function(b){for(var c=JSON.parse(b.replace("<resp>","").replace("</resp>","")).data,d="",e=0;e<Math.min(c.length,10);e++)d+="<tr><td>"+c[e].sid+"</td><td>"+c[e].score+"</td></tr>";a.text('<table width="560">'+d+"</table>")}}),Crafty.e("TxtLink").textFont({size:"36px"}).size(150,50).at(0,420).setup("backtxt","&larr; Back"),Crafty.DrawManager.draw(),document.getElementById("backtxt").onclick=function(){Crafty.scene("Menu")}}),Crafty.scene("Credits",function(){Crafty.e("Txt").textFont({size:"36px"}).size(600,40).at(20,20).css({color:"white","text-align":"left"}).text("Credits"),Crafty.e("Txt").textFont({size:"18px"}).size(560,260).at(40,80).css({color:"white","text-align":"left"}).text('An HTML5 game written in JavaScript over the course of one week.<br><br>&ldquo;Wah Game Loop&rdquo; &amp; &ldquo;Funk Game Loop&rdquo; by Kevin MacLeod (<a href="http://incompetech.com/">incompetech.com</a>)<br>Various sound effects from <a href="http://www.freesound.org/">freesound.org</a><br><br>Powered by:<br><br><a href="http://craftyjs.com/"><img src="assets/crafty-logo.png" /></a><a href="http://sagittarius-ogs.appspot.com/"><img src="assets/sag-logo.png" /></a>'),Crafty.e("TxtLink").textFont({size:"36px"}).size(150,50).at(0,420).setup("backtxt","&larr; Back"),Crafty.DrawManager.draw(),document.getElementById("backtxt").onclick=function(){Crafty.scene("Menu")}}),Crafty.scene("Game",function(){Crafty.audio.stop(),Crafty.audio.play("gamemusic",-1),window.hasPowerup=!1,window.hasBacon=!1,window.hasMuffin=!1,window.hasFries=!1,window.hasMelon=!1,window.hasDonut=!1;var a=Crafty.e("Txt").size(320,50).at(8,5).text("Score: 0").css({color:"white","text-align":"left"}),b=Crafty.e("Countdown").size(190,50).at(400,5).text("2:00.00").css({color:"white","text-align":"right"}),c=0,d=Crafty.e("Button, pauseNorm").at(600,8).setup(0,0,1).bind("Click",function(){if(!Crafty.isPaused()){var a=Crafty.e("TxtLink").size(320,50).at(160,200).setup("resumetxt","Resume"),b=Crafty.e("TxtLink").size(320,50).at(160,240).setup("menutxt","Back to Menu");Crafty.DrawManager.draw(),document.getElementById("resumetxt").onclick=function(){a.destroy(),b.destroy(),Crafty.pause(),Crafty.audio.togglePause("gamemusic")},document.getElementById("menutxt").onclick=function(){Crafty.scene("Menu")},Crafty.pause(),Crafty.audio.togglePause("gamemusic")}});d.z=100,Crafty.e("Ground, ground"),Crafty.e("Solid").size(20,400).at(-20,0),Crafty.e("Solid").size(20,400).at(640,0),Crafty.e("Solid").size(640,20).at(0,-20);var e=Crafty.e("Player").at(0,336).gravity("ground").gravityConst(.5),f=Crafty.e("PizzaManager");this.bind("PizzaEaten",function(b){var d=1;"supreme"==b?d=5:"veggie"==b?d=3:"pepperoni"==b&&(d=2),window.hasDonut&&(d*=2),c+=d,a.text("Score: "+c)}),this.bind("TimesUp",function(){b.destroy(),d.destroy(),f.destroy(),Crafty.e("Toast").textFont({size:"48px"}).size(200,50).at(220,200).text("Time's Up!").bind("TweenEnd",function(b){if("alpha"!=b){e.disableControl(),e.trigger("NewDirection",{x:0,y:0}),e._speed=0,a.destroy(),Crafty.e("Txt").textFont({size:"72px"}).size(600,80).at(20,20).css({color:"white"}).text("Score: "+c);var d=Crafty.e("TxtLink").textFont({size:"36px"}).size(210,50).at(5,220).setup("submittxt","Submit Score");Crafty.e("TxtLink").textFont({size:"36px"}).size(210,50).at(215,220).setup("againtxt","Play Again"),Crafty.e("TxtLink").textFont({size:"36px"}).size(210,50).at(425,220).setup("backfromtxt","Back to Menu"),Crafty.e("Txt").textFont({size:"18px"}).size(210,50).at(5,160).css({color:"white"}).text('Name: <input class="lineinput" id="playername" type="text" maxlength="20"></input>'),Crafty.DrawManager.draw(),document.getElementById("submittxt").onclick=function(){document.getElementById("playername").disabled=!0,document.getElementById("submittxt").onclick=function(){return!1},d.text("Submitting..."),window.sag.PostToLeaderboard({name:"davelb1",score:c,scoreid:document.getElementById("playername").value,callback:function(){d.text("Success!")}})},document.getElementById("againtxt").onclick=function(){Crafty.scene("Game")},document.getElementById("backfromtxt").onclick=function(){Crafty.scene("Menu")}}})});var g=3;Crafty.e("Delay").delay(function(){var a=g;0==g&&(a="Go!",b.start(),f.start()),Crafty.e("Toast").textFont({size:"48px"}).size(200,50).at(220,200).text(a),g--},1e3,3)},function(){this.unbind("PizzaEaten"),this.unbind("TimesUp")}),Crafty.scene("Loading",function(){Crafty.e("Txt").size(320,50).at(160,200).text("Loading..."),Crafty.load(["assets/sprite.png","assets/dave-sprite.png","assets/dave-logo.png","assets/funk_game_loop.mp3","assets/funk_game_loop.ogg","assets/wah_game_loop.mp3","assets/wah_game_loop.ogg","assets/chomp.mp3","assets/chomp.ogg","assets/burp.mp3","assets/burp.ogg","assets/splat.mp3","assets/splat.ogg","assets/powerup.mp3","assets/powerup.ogg","assets/powerdown.mp3","assets/powerdown.ogg"],function(){Crafty.sprite(32,"assets/sprite.png",{pauseNorm:[0,0,1,1],pauseOver:[1,0,1,1],pauseClik:[2,0,1,1]}),Crafty.sprite(64,"assets/sprite.png",{cheese:[0,1,1,1],pepperoni:[0,2,1,1],veggie:[0,3,1,1],supreme:[0,4,1,1],bacon:[0,5,1,1],muffin:[0,6,1,1],fries:[0,7,1,1],melon:[0,8,1,1],donut:[0,9,1,1]}),Crafty.sprite(64,"assets/dave-sprite.png",{daveNorm:[0,0,1,1]}),Crafty.audio.add({gamemusic:["assets/funk_game_loop.mp3","assets/funk_game_loop.ogg"],menumusic:["assets/wah_game_loop.mp3","assets/wah_game_loop.ogg"],chomp:["assets/chomp.mp3","assets/chomp.ogg"],burp:["assets/burp.mp3","assets/burp.ogg"],splat:["assets/splat.mp3","assets/splat.ogg"],powerup:["assets/powerup.mp3","assets/powerup.ogg"],powerdown:["assets/powerdown.mp3","assets/powerdown.ogg"]}),Crafty.scene("Menu")})});